<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoTogether - Camping Adventures</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Leaflet Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .apple-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
        }
        .apple-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .apple-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        .apple-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .material-icons { font-size: inherit; }
        .form-input {
            height: 42px;
            padding: 0 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s ease;
            background-color: white;
            appearance: none;
        }
        .form-input:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        .form-textarea {
            min-height: 84px;
            padding: 12px;
            resize: vertical;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 via-white to-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="max-w-7xl mx-auto flex justify-between items-center mb-12 px-4">
            <div>
                <h1 class="text-4xl font-bold text-gray-900 mb-1 tracking-tight flex items-center">
                    <span class="material-icons text-4xl mr-3 text-green-600">nature</span>GoTogether
                </h1>
                <p class="text-gray-600 font-medium">Discover and join amazing camping adventures!</p>
            </div>
            <div id="headerUserSection" class="hidden flex items-center gap-3">
                <button id="headerUserProfileBtn" class="flex items-center gap-2 text-gray-700 hover:text-gray-900 font-medium transition-colors">
                    <span class="material-icons text-2xl">account_circle</span>
                    <span id="headerUserName"></span>
                </button>
                <button id="headerLogoutBtn" 
                        class="bg-gray-900 text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition-all duration-200 font-medium">
                    <span class="material-icons text-sm mr-2">logout</span>Sign Out
                </button>
            </div>
        </div>

        <!-- Auth Container -->
        <div id="authContainer" class="max-w-md mx-auto apple-card p-8">
            <!-- Login Form -->
            <div id="loginForm">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">Sign In</h2>
                <form id="loginFormElement">
                    <div class="mb-4">
                        <label for="loginEmail" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="loginEmail" required
                               class="w-full form-input">
                    </div>
                    <div class="mb-6">
                        <label for="loginPassword" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" id="loginPassword" required
                               class="w-full form-input">
                    </div>
                    <button type="submit" 
                            class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-200">
                        Sign In
                    </button>
                </form>
                <p class="mt-4 text-center text-sm text-gray-600">
                    Don't have an account? 
                    <button id="showRegister" class="text-blue-600 hover:text-blue-800 font-medium">Sign up</button>
                </p>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="hidden">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6 text-center">Create Account</h2>
                <form id="registerFormElement">
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="firstName" class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                            <input type="text" id="registerFirstName" required maxlength="50"
                               class="w-full form-input">
                        </div>
                        <div>
                            <label for="lastName" class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                            <input type="text" id="registerLastName" required maxlength="50"
                                   class="w-full form-input">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label for="registerEmail" class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="registerEmail" required
                               class="w-full form-input">
                    </div>
                    <div class="mb-4">
                        <label for="registerPassword" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" id="registerPassword" required minlength="6"
                               class="w-full form-input">
                        <p class="text-xs text-gray-500 mt-1">Minimum 6 characters</p>
                    </div>
                    
                    <!-- Optional Profile Information -->
                    <div class="border-t pt-4 mb-4">
                        <h3 class="text-lg font-medium text-gray-800 mb-3">Camping Preferences (Optional)</h3>
                        <p class="text-sm text-gray-600 mb-4">Help others find you for compatible camping trips</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="registerCamperType" class="block text-sm font-medium text-gray-700 mb-2">Camper Type</label>
                                <select id="registerCamperType" class="w-full form-input">
                                    <option value="">Select camper type...</option>
                                    <option value="tent">Tent Camping</option>
                                    <option value="trailer">Travel Trailer</option>
                                    <option value="rv">RV/Motorhome</option>
                                    <option value="van">Van/Camper Van</option>
                                    <option value="fifth_wheel">5th Wheel</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="registerGroupSize" class="block text-sm font-medium text-gray-700 mb-2">Group Size</label>
                                <input type="number" id="registerGroupSize" min="1" max="20" value="1" 
                                       class="w-full form-input">
                            </div>
                            
                            <div>
                                <label for="registerDietary" class="block text-sm font-medium text-gray-700 mb-2">Dietary Restrictions</label>
                                <select id="registerDietary" class="w-full form-input">
                                    <option value="">None</option>
                                    <option value="vegetarian">Vegetarian</option>
                                    <option value="vegan">Vegan</option>
                                    <option value="gluten_free">Gluten-Free</option>
                                    <option value="dairy_free">Dairy-Free</option>
                                    <option value="nut_allergy">Nut Allergy</option>
                                    <option value="kosher">Kosher</option>
                                    <option value="halal">Halal</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="registerPhone" class="block text-sm font-medium text-gray-700 mb-2">Phone (Optional)</label>
                                <input type="tel" id="registerPhone" placeholder="(555) 123-4567"
                                       class="w-full form-input">
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <label for="registerBio" class="block text-sm font-medium text-gray-700 mb-2">Bio (Optional)</label>
                            <textarea id="registerBio" rows="2" placeholder="Tell others about your camping experience..."
                                      class="w-full form-input resize-none"></textarea>
                        </div>
                    </div>
                    
                    <button type="submit" 
                            class="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition duration-200">
                        Create Account
                    </button>
                </form>
                <p class="mt-4 text-center text-sm text-gray-600">
                    Already have an account? 
                    <button id="showLogin" class="text-blue-600 hover:text-blue-800 font-medium">Sign in</button>
                </p>
            </div>

        </div>

        <!-- Dashboard Container -->
        <div id="dashboardContainer" class="max-w-6xl mx-auto apple-card p-8 hidden">
            <!-- Dashboard (shown after login) -->
            <div id="dashboard">
                <!-- Dashboard Title -->
                <div id="dashboardTitle" class="mb-10">
                    <h2 class="text-3xl font-bold text-gray-900 tracking-tight">My Camping Dashboard</h2>
                    <p class="text-gray-600 font-medium mt-1">Your upcoming adventures</p>
                </div>

                <!-- Main Action Buttons -->
                <div id="mainActionButtons" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
                    <button id="createTripBtn" 
                            class="apple-button text-white py-8 px-6 text-center group">
                        <span class="material-icons text-3xl mb-3 block">add_circle</span>
                        <div class="font-semibold text-lg mb-1">Create Trip</div>
                        <div class="text-sm opacity-90">Organize a new adventure</div>
                    </button>
                    <button id="joinTripBtn" 
                            class="apple-button text-white py-8 px-6 text-center group">
                        <span class="material-icons text-3xl mb-3 block">search</span>
                        <div class="font-semibold text-lg mb-1">Join Trip</div>
                        <div class="text-sm opacity-90">Find trips to join</div>
                    </button>
                    <button id="browseTripsBtn" 
                            class="apple-button text-white py-8 px-6 text-center group">
                        <span class="material-icons text-3xl mb-3 block">public</span>
                        <div class="font-semibold text-lg mb-1">Browse Public</div>
                        <div class="text-sm opacity-90">Explore all trips</div>
                    </button>
                </div>

                <!-- Browse All Trips Section -->
                <div id="allTripsContainer" class="hidden mt-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-gray-900 tracking-tight">Browse Public Trips</h3>
                        <button id="backToMyTripsBtn" class="text-blue-600 hover:text-blue-800 font-medium flex items-center">
                            <span class="material-icons text-sm mr-2">arrow_back</span>Back to My Trips
                        </button>
                    </div>
                    <div id="allTripsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- All trips will be loaded here -->
                    </div>
                </div>

                <!-- Inline Trip Creation Form -->
                <div id="createTripSection" class="hidden mt-8 bg-green-50 border border-green-200 rounded-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-gray-900 tracking-tight">Create New Camping Trip</h3>
                        <button id="cancelCreateTripBtn" class="text-gray-400 hover:text-gray-600 p-1">
                            <span class="material-icons text-xl">close</span>
                        </button>
                    </div>

                    <form id="createTripForm">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label for="tripTitle" class="block text-sm font-medium text-gray-700 mb-1">Trip Title *</label>
                                <input type="text" id="tripTitle" required maxlength="255"
                                       class="w-full form-input"
                                       placeholder="e.g., Yosemite Backpacking Adventure">
                            </div>
                            <div>
                                <label for="tripType" class="block text-sm font-medium text-gray-700 mb-1">Trip Type *</label>
                                <select id="tripType" required
                                        class="w-full form-input">
                                    <option value="">Select type</option>
                                    <option value="car_camping">Car Camping</option>
                                    <option value="backpacking">Backpacking</option>
                                    <option value="rv_camping">RV Camping</option>
                                    <option value="glamping">Glamping</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label for="tripLocation" class="block text-sm font-medium text-gray-700 mb-1">Location *</label>
                                <input type="text" id="tripLocation" required maxlength="255"
                                       class="w-full form-input"
                                       placeholder="e.g., Yosemite National Park, CA">
                            </div>
                            <div>
                                <label for="tripStartDate" class="block text-sm font-medium text-gray-700 mb-1">Start Date *</label>
                                <input type="date" id="tripStartDate" required
                                       class="w-full form-input">
                            </div>
                            <div>
                                <label for="tripEndDate" class="block text-sm font-medium text-gray-700 mb-1">End Date *</label>
                                <input type="date" id="tripEndDate" required
                                       class="w-full form-input">
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-3">Trip Visibility *</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="radio" name="tripVisibility" value="public" id="tripPublic" required
                                           class="mr-3 text-green-600 focus:ring-green-500">
                                    <div>
                                        <div class="font-medium text-gray-900">Public Trip</div>
                                        <div class="text-sm text-gray-600">Anyone can discover and join this trip</div>
                                    </div>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="tripVisibility" value="private" id="tripPrivate" required
                                           class="mr-3 text-green-600 focus:ring-green-500">
                                    <div>
                                        <div class="font-medium text-gray-900">Private Trip</div>
                                        <div class="text-sm text-gray-600">Only people with the trip code can join</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="tripDescription" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <textarea id="tripDescription" rows="3" maxlength="2000"
                                      class="w-full form-input form-textarea"
                                      placeholder="Describe the camping trip, what to expect, what to bring, etc."></textarea>
                        </div>

                        <div id="tripCodeDisplay" class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg hidden">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-medium text-blue-900">Trip Code</div>
                                    <div class="text-sm text-blue-700">Share this code with others to let them join your private trip</div>
                                </div>
                                <div class="text-xl font-mono font-bold text-blue-900" id="generatedTripCode"></div>
                            </div>
                        </div>

                        <div class="flex gap-4">
                            <button type="submit"
                                    class="apple-button text-white py-3 px-8 font-medium flex items-center">
                                <span class="material-icons text-sm mr-2">add_circle</span>Create Trip
                            </button>
                            <button type="button" id="cancelCreateTripBtn2"
                                    class="bg-gray-200 text-gray-700 py-3 px-8 rounded-lg hover:bg-gray-300 transition-all duration-200 font-medium">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>

                <!-- My Trips Section -->
                <div id="myTripsContainer">
                    <h3 class="text-2xl font-bold text-gray-900 mb-6 tracking-tight">My Upcoming Trips</h3>
                    <div id="myTripsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- User's trips will be loaded here -->
                    </div>
                    <div id="noMyTrips" class="text-center py-12 text-gray-500 hidden">
                        <span class="material-icons text-6xl mb-4 text-gray-300">terrain</span>
                        <h4 class="text-xl font-semibold mb-2">No trips yet!</h4>
                        <p class="mb-4">Start your camping adventure by creating or joining a trip.</p>
                        <button onclick="document.getElementById('createTripBtn').click()" 
                                class="apple-button text-white px-6 py-3 font-medium flex items-center mx-auto">
                            <span class="material-icons text-sm mr-2">add_circle</span>Create Your First Trip
                        </button>
                    </div>
                </div>
            </div>

            <!-- User Profile Container -->
            <div id="profileContainer" style="display: none;">
                <!-- Profile View -->
                <div id="profileView">
                    <div class="apple-card p-8 max-w-3xl mx-auto">
                        <div class="flex justify-between items-start mb-8">
                            <div>
                                <h2 id="profileTitle" class="text-3xl font-bold text-gray-900 tracking-tight mb-2"></h2>
                                <p class="text-gray-600">Camping Profile</p>
                            </div>
                            <div class="flex gap-3">
                                <button id="editProfileBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-all duration-200 font-medium hidden">
                                    <span class="material-icons text-sm mr-2">edit</span>Edit Profile
                                </button>
                                <button id="backFromProfileBtn" class="text-gray-600 hover:text-gray-800 font-medium flex items-center">
                                    <span class="material-icons text-sm mr-2">arrow_back</span>Back to Dashboard
                                </button>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- Personal Information -->
                            <div class="space-y-6">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                        <span class="material-icons text-xl mr-2">person</span>Personal Information
                                    </h3>
                                    <div class="space-y-3">
                                        <div>
                                            <label class="text-sm font-medium text-gray-600">Name</label>
                                            <p id="profileName" class="text-gray-900 font-medium"></p>
                                        </div>
                                        <div>
                                            <label class="text-sm font-medium text-gray-600">Bio</label>
                                            <p id="profileBio" class="text-gray-900"></p>
                                        </div>
                                        <div id="profilePhoneSection">
                                            <label class="text-sm font-medium text-gray-600">Phone</label>
                                            <p id="profilePhone" class="text-gray-900"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Camping Preferences -->
                            <div class="space-y-6">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                        <span class="material-icons text-xl mr-2">outdoor_grill</span>Camping Style
                                    </h3>
                                    <div class="space-y-3">
                                        <div>
                                            <label class="text-sm font-medium text-gray-600">Camper Type</label>
                                            <p id="profileCamperType" class="text-gray-900 font-medium"></p>
                                        </div>
                                        <div>
                                            <label class="text-sm font-medium text-gray-600">Group Size</label>
                                            <p id="profileGroupSize" class="text-gray-900"></p>
                                        </div>
                                        <div>
                                            <label class="text-sm font-medium text-gray-600">Dietary Restrictions</label>
                                            <p id="profileDietary" class="text-gray-900"></p>
                                        </div>
                                    </div>
                                </div>

                                <!-- Member Since -->
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                        <span class="material-icons text-xl mr-2">calendar_today</span>Member Info
                                    </h3>
                                    <div>
                                        <label class="text-sm font-medium text-gray-600">Member Since</label>
                                        <p id="profileMemberSince" class="text-gray-900"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Edit Form -->
                <div id="profileEditForm" style="display: none;">
                    <div class="apple-card p-8 max-w-3xl mx-auto">
                        <div class="flex justify-between items-center mb-8">
                            <h2 class="text-3xl font-bold text-gray-900 tracking-tight">Edit Profile</h2>
                            <button id="cancelEditProfileBtn" class="text-gray-400 hover:text-gray-600 p-1">
                                <span class="material-icons text-xl">close</span>
                            </button>
                        </div>

                        <form id="updateProfileForm">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <!-- Personal Information -->
                                <div class="space-y-4">
                                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                        <span class="material-icons text-xl mr-2">person</span>Personal Information
                                    </h3>
                                    
                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label for="editFirstName" class="block text-sm font-medium text-gray-700 mb-1">First Name *</label>
                                            <input type="text" id="editFirstName" required maxlength="100" class="w-full form-input">
                                        </div>
                                        <div>
                                            <label for="editLastName" class="block text-sm font-medium text-gray-700 mb-1">Last Name *</label>
                                            <input type="text" id="editLastName" required maxlength="100" class="w-full form-input">
                                        </div>
                                    </div>

                                    <div>
                                        <label for="editBio" class="block text-sm font-medium text-gray-700 mb-1">Bio</label>
                                        <textarea id="editBio" rows="3" maxlength="1000" class="w-full form-input form-textarea" placeholder="Tell other campers about yourself..."></textarea>
                                    </div>

                                    <div>
                                        <label for="editPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                                        <input type="tel" id="editPhone" maxlength="20" class="w-full form-input" placeholder="(555) 123-4567">
                                    </div>
                                </div>

                                <!-- Camping Preferences -->
                                <div class="space-y-4">
                                    <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                        <span class="material-icons text-xl mr-2">outdoor_grill</span>Camping Preferences
                                    </h3>

                                    <div>
                                        <label for="editCamperType" class="block text-sm font-medium text-gray-700 mb-1">Camper Type</label>
                                        <select id="editCamperType" class="w-full form-input">
                                            <option value="">Select your camping style</option>
                                            <option value="tent">Tent Camping</option>
                                            <option value="trailer">Travel Trailer</option>
                                            <option value="rv">RV/Motorhome</option>
                                            <option value="van">Van/Camper Van</option>
                                            <option value="fifth_wheel">5th Wheel</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label for="editGroupSize" class="block text-sm font-medium text-gray-700 mb-1">People in Your Group</label>
                                        <input type="number" id="editGroupSize" min="1" max="20" value="1" class="w-full form-input">
                                    </div>

                                    <div>
                                        <label for="editDietary" class="block text-sm font-medium text-gray-700 mb-1">Dietary Restrictions</label>
                                        <select id="editDietary" class="w-full form-input">
                                            <option value="">No restrictions</option>
                                            <option value="vegetarian">Vegetarian</option>
                                            <option value="vegan">Vegan</option>
                                            <option value="gluten_free">Gluten-Free</option>
                                            <option value="dairy_free">Dairy-Free</option>
                                            <option value="nut_allergy">Nut Allergy</option>
                                            <option value="kosher">Kosher</option>
                                            <option value="halal">Halal</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="flex gap-4 mt-8 pt-6 border-t">
                                <button type="submit" class="apple-button text-white py-3 px-8 font-medium flex items-center">
                                    <span class="material-icons text-sm mr-2">save</span>Save Changes
                                </button>
                                <button type="button" id="cancelEditProfileBtn2" class="bg-gray-200 text-gray-700 py-3 px-8 rounded-lg hover:bg-gray-300 transition-all duration-200 font-medium">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error/Success Messages -->
        <div id="messageContainer" class="max-w-md mx-auto mt-4"></div>
    </div>


    <script src="app.js"></script>
    <script>
        // Initialize the app and make it globally available
        window.app = new CampingApp();
        app = window.app; // Also assign to global app variable
        
        // Simple address lookup using OpenStreetMap
        function initAddressLookup() {
            const locationInput = document.getElementById('tripLocation');
            if (!locationInput) return;
            
            let suggestionsList = null;
            let debounceTimer = null;
            
            // Create suggestions dropdown
            function createSuggestionsList() {
                if (suggestionsList) return;
                
                suggestionsList = document.createElement('div');
                suggestionsList.style.cssText = `
                    position: absolute;
                    top: 100%;
                    left: 0;
                    right: 0;
                    background: white;
                    border: 1px solid #d1d5db;
                    border-top: none;
                    border-radius: 0 0 6px 6px;
                    max-height: 200px;
                    overflow-y: auto;
                    z-index: 1000;
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                    display: none;
                `;
                
                // Make parent container relative
                locationInput.parentElement.style.position = 'relative';
                locationInput.parentElement.appendChild(suggestionsList);
            }
            
            // Search for addresses
            async function searchAddresses(query) {
                if (query.length < 3) {
                    suggestionsList.style.display = 'none';
                    return;
                }
                
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=5&countrycodes=us,ca&addressdetails=1`);
                    const results = await response.json();
                    
                    displaySuggestions(results);
                } catch (error) {
                    console.log('Address lookup error:', error);
                }
            }
            
            // Display suggestions
            function displaySuggestions(results) {
                if (!results || results.length === 0) {
                    suggestionsList.style.display = 'none';
                    return;
                }
                
                suggestionsList.innerHTML = '';
                
                results.forEach(result => {
                    const item = document.createElement('div');
                    item.style.cssText = `
                        padding: 10px;
                        cursor: pointer;
                        border-bottom: 1px solid #f3f4f6;
                        font-size: 14px;
                    `;
                    item.textContent = result.display_name;
                    
                    item.addEventListener('mouseenter', () => {
                        item.style.backgroundColor = '#f3f4f6';
                    });
                    
                    item.addEventListener('mouseleave', () => {
                        item.style.backgroundColor = 'white';
                    });
                    
                    item.addEventListener('click', () => {
                        locationInput.value = result.display_name;
                        suggestionsList.style.display = 'none';
                    });
                    
                    suggestionsList.appendChild(item);
                });
                
                suggestionsList.style.display = 'block';
            }
            
            // Set up event listeners
            createSuggestionsList();
            
            locationInput.addEventListener('input', (e) => {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => {
                    searchAddresses(e.target.value);
                }, 300);
            });
            
            // Hide suggestions when clicking outside
            document.addEventListener('click', (e) => {
                if (!locationInput.contains(e.target) && !suggestionsList.contains(e.target)) {
                    suggestionsList.style.display = 'none';
                }
            });
            
            console.log('Address lookup initialized');
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initAddressLookup);
        } else {
            initAddressLookup();
        }
    </script>
</body>
</html>
